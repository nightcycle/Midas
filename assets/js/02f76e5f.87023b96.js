"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[766],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>p});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=d(a),p=i,m=h["".concat(s,".").concat(p)]||h[p]||c[p]||r;return a?n.createElement(m,o(o({ref:t},u),{},{components:a})):n.createElement(m,o({ref:t},u))}));function p(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var d=2;d<r;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},97687:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));const r={sidebar_position:2},o="Roblox",l={unversionedId:"Integration/Roblox",id:"Integration/Roblox",title:"Roblox",description:"Integrating the Midas framework into your game's code is fairly easy, however it requires pre-requisite knowledge being provided to you now.",source:"@site/docs/Integration/Roblox.md",sourceDirName:"Integration",slug:"/Integration/Roblox",permalink:"/midas/docs/Integration/Roblox",draft:!1,editUrl:"https://github.com/nightcycle/midas/edit/master/docs/Integration/Roblox.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"VS Code",permalink:"/midas/docs/Integration/VSCode"},next:{title:"PlayFab",permalink:"/midas/docs/Integration/PlayFab"}},s={},d=[{value:"Initial Set-Up",id:"initial-set-up",level:2},{value:"Configuring the Framework",id:"configuring-the-framework",level:3},{value:"Initializing the Framework",id:"initializing-the-framework",level:3},{value:"Connecting Players to Framework",id:"connecting-players-to-framework",level:3},{value:"Using Midaii",id:"using-midaii",level:2},{value:"Constructing a Midas",id:"constructing-a-midas",level:3},{value:"Binding State to Midas",id:"binding-state-to-midas",level:3},{value:"Firing an Event from Midas",id:"firing-an-event-from-midas",level:3},{value:"The Midas Hierarchy",id:"the-midas-hierarchy",level:3},{value:"Cutting Back on Templates",id:"cutting-back-on-templates",level:4},{value:"Only Recording Changes in State",id:"only-recording-changes-in-state",level:4},{value:"Conclusion",id:"conclusion",level:2}],u={toc:d};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"roblox"},"Roblox"),(0,i.kt)("p",null,"Integrating the Midas framework into your game's code is fairly easy, however it requires pre-requisite knowledge being provided to you now."),(0,i.kt)("h2",{id:"initial-set-up"},"Initial Set-Up"),(0,i.kt)("p",null,"These are the things you need to complete for each game."),(0,i.kt)("h3",{id:"configuring-the-framework"},"Configuring the Framework"),(0,i.kt)("p",null,"In order to best support your workflow you can configure many different aspects of the framework. You can read up further on the properties available to configure under the ConfigurationData type on the Interface API page, however you don't need to write to all of them when configuring. In the below example only about half of the variables are being set. Typically you should at least set the version as you'll want to be able to tell which version of the game data originates from. You must run this script on the server for it to work, otherwise it will error."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'    local WallyPackages = game.ReplicatedStorage.Packages\n    local MidasAnalytics = require(WallyPackages.Midas)\n\n    MidasAnalytics:Configure({\n        Version = {\n            Major = 1,\n            Minor = 0,\n            Patch = 0,\n            Hotfix = 2,\n            Tag = "Alpha",\n        },\n        SendDeltaState = false,\n        Templates = {\n            Join = true,\n            Chat = false,\n            Demographics = true,\n            Policy = false,\n            Settings = false,\n        }\n    })\n')),(0,i.kt)("h3",{id:"initializing-the-framework"},"Initializing the Framework"),(0,i.kt)("p",null,"Assuming you are using the native PlayFab based data storage solution, you will want to initialize the framework with the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/gaming/playfab/personas/developer"},"TitleId")," and ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/gaming/playfab/gamemanager/secret-key-management"},"Dev Secret Key"),". As you may have guessed from the name \"Dev Secret Key\", it's a secret. Since it's a secret please run this in a script stored exclusively under ServerScriptService to avoid exploiters from finding it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'\nlocal TITLE_ID = "ABC123"\nlocal DEV_SECRET_KEY = "A1B2C3D4E5F6G7H8I9"\n\nMidasAnalytics.init(TITLE_ID, DEV_SECRET_KEY)\n\n')),(0,i.kt)("h3",{id:"connecting-players-to-framework"},"Connecting Players to Framework"),(0,i.kt)("p",null,"The framework automatically detects new players entering and will bind them to the relevant data templates as dictated in the configuration. Since some templates record client-side information it's important that you require the Midas framework package on both client and server, otherwise you can experience some data loss."),(0,i.kt)("h2",{id:"using-midaii"},"Using Midaii"),(0,i.kt)("p",null,'At the heart of the Midas framework is a "Midas", plurally known as "Midaii". These are little data collection helpers that do a ton of work behind the scenes to make data collection and event firing as easy as possible. '),(0,i.kt)("h3",{id:"constructing-a-midas"},"Constructing a Midas"),(0,i.kt)("p",null,"Midaii can be constructed on the server or client. In the below example we'll be creating a Midas for a player's sword. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'local player = game.Players.LocalPlayer\nlocal path = "Combat/Weapon/Sword"\nlocal swordMidas = MidasAnalytics:GetMidas(player, path)\n')),(0,i.kt)("p",null,"The path variable provides context on where to store the information in the eventual dataset, a functionality we explore further farther down on this page. "),(0,i.kt)("p",null,"You also don't need to worry about garbage collection, as Midaii delete themselves when a player leaves. If a Midas with the same path already exists it will pass you that Midas rather than creating a new one."),(0,i.kt)("h3",{id:"binding-state-to-midas"},"Binding State to Midas"),(0,i.kt)("p",null,"If there's data you'd like to track, just attach it to a Midas! "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'\nlocal swordKills = 0\nswordMidas:SetState("Kills", function() return swordKills end)\n\nlocal damagePerSecond = 0\nswordMidas:SetState("DPS", function() return damagePerSecond end)\n\n')),(0,i.kt)("p",null,"In order to keep things simple, rather than binding the information directly to the Midas you instead provide a function it can call to get the current value. This allows for the easy tracking of local variables without needing to manually update the Midas whenever one of them changes."),(0,i.kt)("h3",{id:"firing-an-event-from-midas"},"Firing an Event from Midas"),(0,i.kt)("p",null,"It was game designer Sid Meier who once said \"A game is a series of interesting choices.\", as a game analyst it's your job to track those choices to see if they're interesting. Here's an example of an event you might fire if the sword just got equipped."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'\nswordMidas:Fire("Equipped")\n\n')),(0,i.kt)("p",null,'The event itself will fire to framework (even if it\'s on the client), where it will be formatted and bundled and sent off to PlayFab / your custom data storage solution. The key itself doesn\'t need to be unique, as it is actually added onto the end of the path variable set when the midas was constructed. For example, "Equipped" is recorded as "Combat/Weapon/Sword/Equipped".'),(0,i.kt)("p",null,"You may notice that there is no place to include extra information with the fired events unlike many other libraries. I've gone back and forth on whether to add support for one-off data binding with events, but for now I feel it is best for you to bind all useful data, no matter how temporary, as a state. "),(0,i.kt)("p",null,"Should you not want to use PlayFab to store your data, on the server use ",(0,i.kt)("inlineCode",{parentName:"p"},"MidasAnalytics:GetEventSignal()")," to have all the compiled event data sent directly to you, allowing you to hook it up and send wherever is needed. This function can also be quite useful for debugging. "),(0,i.kt)("h3",{id:"the-midas-hierarchy"},"The Midas Hierarchy"),(0,i.kt)("p",null,"Whenever a Midas is fired, the framework basically takes a photograph of the entire game. Every single Midas registerred to a player is compiled, calling their bound state functions and returning tables with their outputs. Then, using the path variable of each midas, the resulting data is organized into a singular massive data structure."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},"    {\n        Combat: {\n            Weapon: {\n                Sword: {\n                    Kills: 0,\n                    DPS: 0,\n                }\n            }\n        }\n    }\n")),(0,i.kt)("p",null,"In the above example, you can see how it separated the path into layers of tables with a single Midas. A more complicated table with multiple Midaii will look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'    {\n        FriendsInServer: {\n            Old: 2,\n            New: 1,\n        },\n        Combat: {\n            Weapon: {\n                Sword: {\n                    Kills: 0,\n                    DPS: 0,\n                    Blade: {\n                        IsPoison: false,\n                        Sharpness: 0.5,\n                        Length: 3,\n                    },\n                }\n                Gun: {\n                    Kills: 0\n                    Range: 50\n                },\n            },\n            Stats: {\n                Deaths: 6,\n                Kills: 3,\n                KDR: 0.5,\n            }\n            Health: 0\n        },\n        Map: {\n            Lighting: {\n                Precipitation: 0,\n                Fog: 0.5,\n                Brightness: 0.5,\n                ClockTime: 15.63,\n            },\n            Biome: "Forest",\n            NearbyPlayers: 2,\n        }\n    }\n')),(0,i.kt)("p",null,"This mega-table is constructed every single time a Midas is fired. This table is then sent with the event to PlayFab / your data storage solution. If after encoding your table is larger than 500 characters it will error and the event will be lost. There are a few things you can do to avoid this."),(0,i.kt)("h4",{id:"cutting-back-on-templates"},"Cutting Back on Templates"),(0,i.kt)("p",null,"In the initial configuration you can create various template Midaii to track useful data about the player. While all of the data tracked is useful, not all of it is equally useful. For example if your game is relatively small and has no reason to worry about lag, consider cutting the ServerPerformance and ClientPerformance templates. The ServerPerformance template is particularly massive due to it's recording of a ton of peripheral data."),(0,i.kt)("p",null,"Some other templates you may consider filtering for a reduced size are the Demographics and Settings templates. The Demographics template contains a ton of useful information ranging from account age to platform to language, however if you're fairly confident in who your audience is it may make more sense to create your own custom alternative with less information."),(0,i.kt)("h4",{id:"only-recording-changes-in-state"},"Only Recording Changes in State"),(0,i.kt)("p",null,"If the SendDeltaState configuration variable is flipped to true, when compiling the mega-table above it will only include data which has changed since the previous event. This can cut down on the amount of data dramatically, however it brings in two new issues: increased difficulty in unloading data, and increased risk of data loss."),(0,i.kt)("p",null,"Of the two, the increased difficulty unloading data can be trivial if you know what you're doing. Basically, when you query the data in Power Bi later, you need to sort the events by session id, then sort them by index / order. From there you can use a function called ",(0,i.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/power-query/fill-values-column"},'"Fill Down"')," which will take the previous value and insert it below when the cell is empty. It slows down the query a bit, but once the query is set-up you likely won't run it more than a few times an hour."),(0,i.kt)("p",null,"The real issue of this method is that there's an elevated chance for data corruption."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'-- Character health is tracked by a Midas.\nlocal health = 100\ncharacterMidas:SetState("Health", function() return health end)\n\n--Character is damaged\nhealth = 2\ncharacterMidas:Fire("ReceiveDamage") --ERROR, THIS FAILED!\n\n-- Character runs away\ncharacterMidas:Fire("Flee")\n\n')),(0,i.kt)("p",null,"In the above scenario, because the delta state failed, when the tables are later filled down the Flee event will be attributed a health of 100 because that was the last health update it received. As you can guess, having a character flee at full health and at almost 0 health are very different experiences - this is why this method is arguably more dangerous."),(0,i.kt)("p",null,"I've included with each event a baked in roblox-side index so that you can estimate how many events are missing. For example if you receive an event with index 4 and an event with index 6, you know 5 didn't make it through. In my experience, around 1% of events tend to disappear currently. Since with analytics you're dealing with sample sizes in the thousands, usually the error caused by this across such a large group isn't a huge issue as for every player who missed that key moment, there are another 99 who recorded it."),(0,i.kt)("p",null,"Over time I plan to add more safeguards, such as handling failed events more intelligently, as well as sprinkling in a few unchanged states to ensure a higher change of correcting failures early. That being said, this will always be more of a risk than the method which sends an entire copy of the player's state each time."),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"And that's about it! There are a few useful functions and utilities worth learning that will improve your quality of life, but the bare necessities are complete. Now that you've completed sending the data, it's time to catch that data on the storage side."))}c.isMDXComponent=!0}}]);